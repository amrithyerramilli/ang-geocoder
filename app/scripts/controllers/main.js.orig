'use strict';

/**
 * @ngdoc function
 * @name angGeocoderApp.controller:MainCtrl
 * @description
 * # MainCtrl
 * Controller of the angGeocoderApp
 */
angular.module('angGeocoderApp')
    .controller('MainCtrl', function($scope, $log, $rootScope, utils, $location) {
<<<<<<< HEAD
        $rootScope.currentStep = 1; // for navbar

        $scope.uploadedFile = null;
        $scope.uploadFile = uploadFile;
        $scope.showValidationErrors = false;
        $scope.uploadDisabled = true;

        // setup watch to enable/disable upload button
        $scope.$watch('uploadedFile', function(newValue, oldValue, scope) {
            if (newValue)
                $scope.uploadDisabled = false;
            else
                $scope.uploadDisabled = true;
        });
=======
>>>>>>> origin/master

        function uploadFile() {
            $rootScope.geocodedData = null;
            $scope.parsedCsv = utils.processData($scope.uploadedFile);
            if (utils.validateSchema($scope.parsedCsv)) {
<<<<<<< HEAD
                $log.info('validation successful. generating geocoded lat/lon');

                $scope.showValidationErrors = false;
                utils.generateGeocodes($scope.parsedCsv)
                    .then(function() {
                        // all ok
                        $log.info('aal izz well, going to next step');
                        $rootScope.geocodedData = $scope.parsedCsv;
                        $location.path('/details');
=======

                alert('validation successful. generating geocoded lat/lon');

                utils.generateGeocodes($scope.parsedCsv)
                    .then(function() {
                        // all ok
                        $log.info('aal izz well, need to go to next step');
                        $rootScope.detailsData = $scope.parsedCsv;
                        // alert("geolocation info successful, please go to details screen");
                        $location.url("/details");
>>>>>>> origin/master
                    }, function(err) {
                        $log.error('oops, geocode fail macha');
                        $log.error(err);
                    });
            } else {
<<<<<<< HEAD
                $scope.showValidationErrors = true;
                $log.log($scope.parsedCsv);
                $log.log('validation failed.');
=======
                alert('validation failed'); // TODO : display validation errors and stay on same page.
>>>>>>> origin/master
            }
        }
    });
